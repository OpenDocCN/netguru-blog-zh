# 用 Docker 整理你的开发环境

> 原文：<http://web.archive.org/web/20230307163032/https://www.netguru.com/blog/declutter-your-development-environment-with-docker>

 使用 docker 来减少磁盘混乱和设置新机器所花费的时间听起来好吗？对我来说的确如此。在本文中，我将向您展示如何开始使用 dockerized 开发环境，这样您就可以体验一下它是什么样子的。我还会在最后给你一些建议，告诉你如何学习你需要了解的关于这个工具的知识。

经过几年的发展，我已经积累了许多需要维护的项目。开始时，它们中的每一个都有一组与前一个稍有不同的依赖关系。现在，他们不仅使用不同的数据库版本，还使用不同种类的数据库。它们甚至跨越了多个技术栈:有一些带 [Django](/web/20221209114910/https://www.netguru.com/services/django-development) 的 [Python](/web/20221209114910/https://www.netguru.com/services/python-development) ，处于不同生命阶段的多个 Rails 应用程序，甚至还有一个旧的 WordPress 站点。我不喜欢把这些都保存在我的机器上，主要有两个原因:

1.  我 80%的时间都不需要这些工具；

2.  我使用不同的机器取决于我在哪里。

Docker 在我的案例中很好地解决了依赖问题。然而，作为一个拥有多台计算机和多种操作系统的用户，我一直在寻找一种方法来存储我的整个开发环境。在我需要安装一台新机器之前，将点文件保存在存储库中是很有帮助的。一个问题出现在我的脑海中——如果我需要做的只是安装 Docker，取出我的开发映像并准备好工作，会怎么样？这个实验在我脑海里已经存在了很长时间。

### 目标

这个设置不会像获取一个容器那么简单，但是已经很接近了。这样做的主要原因是，我不想把我的 SSH 密钥存储在容器或存储库中，我想区分使用不同密钥的机器。当需要撤销对一个受损的密钥或计算机的访问时，这也可能是有帮助的。我将假设您对 Docker 有一些非常基本的了解，已经安装了 Docker，并且已经配置了 SSH 密钥来使用 GitHub。

### 获得基本工具

让我们创建一个名为“development”的目录，并启动一个简单的 Dockerfile，其中只包含 git 和一个文本编辑器。我的图片基于最新版本的 Ubuntu，仅仅是因为我对它最熟悉。

要构建映像，请运行“docker build。-t development ',这将给我们的图像一个名为' development '的标签，以帮助我们在其他容器中找到它。要确认一切正常，请运行“docker images ”:

并通过“docker run -it development”在其中进行探索。

### 提交和推送

这很容易，但现在我们必须添加一些配置，为此我们需要访问主机文件系统。让我们再次运行我们的容器，但是这次我们将把项目的目录挂载为`/development`。该命令应该类似于:

Git 仍然对我们一无所知，所以我们来配置一下:

并初始化新储存库:

现在所有的更改都保存在容器之外，但是如果我们再次运行它，文件将会在一个错误的位置。让我们通过将下面一行添加到 Dockerfile 文件来复制它:

并提交更改:

小心！下一步很有问题，应该自担风险。请记住，Docker 容器包含其他人的代码，并不是所有的代码都是为了让世界变得更美好而创建的。

现在，你已经被警告了，我们可以在 GitHub 上建立一个新的存储库并把代码推到那里。为了将我们的 SSH 设置引入到容器中，我们需要退出它，然后用新的配置重新构建:

并在 SSH 目录安装在正确位置的情况下运行:

有了这些，我们就可以在 GitHub 上推送整个设置了:

### 配置编辑器

编辑器的设置非常相似，但是还需要执行一个步骤，即在容器构建期间安装插件。否则我们必须在每次运行容器时安装它们。让我们配置 Vundle 来管理我们的插件。第一步是添加`. vimrc `文件:

要使它工作，我们需要将`. vimrc `文件复制到正确的位置，安装 Vundle 并安装插件。为此，让我们将以下内容添加到 docker 文件的末尾:

在重新构建容器之后，我们可以像往常一样提交我们的更改，或者使用 vim-escapity 插件。

### 运行应用程序

既然我们已经准备好开始编码，我们应该有一个项目。但是，我们如何实现这一目标呢？在容器中运行容器？不，我们应该并排跑。为了简单起见，我们将运行 Docker 教程中的 whalesay 图像，但是对于任何 Docker 化的项目，想法都是一样的。

首先，让我们在容器中安装 Docker，将它添加到已安装的包中:

重建图像:

并连接 Docker 套接字运行它:

现在，在我们的开发环境中运行的每个容器都可以被主机操作系统访问。让我们验证一下:

您应该会在容器中看到问候语，但是在容器外部也应该可以访问该图像，因此如果您运行:

在您的主机上，您应该得到相同的输出。

### 后续步骤

我希望我让你对这个话题感兴趣。从这里你可以走很多路。作为练习，您应该配置容器不使用“root”帐户，尝试保留 shell 历史或运行您选择的 GUI 应用程序。当前的设置在开发存储库内有项目存储库，所以试着将它们分开。Tmux 用户可以在容器启动时自动连接到会话。像这样的实验是我最喜欢的学习新工具的方式。

### 摘要

这个解决方案完美吗？肯定不是。虽然资源损失比使用虚拟机时要低，但它仍然存在，而且还有其他缺点。一个明显的问题是缺乏与主机操作系统的集成，而这可能是您所需要的。前面提到的 shell 历史问题很容易解决，但是我找到的解决方案没有一个让我满意。如果你频繁切换项目，你可能会厌倦它，并决定回到“老办法”。我会在日常工作中使用这种设置吗？没有，但我肯定会带着新的想法重新审视它，在使用 Docker 的同时学习更多关于它的知识，也许有一天我会改变。也就是说，有人在使用这个概念，他们对此非常满意，所以我鼓励你尝试，形成自己的观点，并与世界分享。