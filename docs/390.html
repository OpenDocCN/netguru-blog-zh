<html>
<head>
<title>We've Pushed Swift Into Embedded Devices and Here's What We Learned So Far</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>我们已经将Swift推向了嵌入式设备，以下是我们迄今为止了解到的情况</h1>
<blockquote>原文：<a href="http://web.archive.org/web/20230307163032/https://www.netguru.com/blog/pushed-swift-into-embedded-devices#0001-01-01">http://web.archive.org/web/20230307163032/https://www.netguru.com/blog/pushed-swift-into-embedded-devices#0001-01-01</a></blockquote><div><span><div class="blog-post__lead h3"><p>物联网。这三个小字的背后隐藏着成千上万的用例。在当前的科技行业中，没有多少话题像这个话题一样具有趋势性和创新性。像Kickstarter或Indiegogo这样的众筹服务也严重依赖于科技行业，如果没有物联网，就不会有这么多成功的项目。毫不奇怪，在Netguru，我们决定更仔细地研究这个话题，并可能尝试一下未来。</p></div><h2> </h2>
<h2><span>我们将Swift推向了嵌入式设备……</span></h2>
<p>哦，是的，我们有。但是嘿，也许你不熟悉这个话题，根本没听说过Swift？那么，让我给你一个快速介绍这种年轻的和不断发展的编程语言，因为它非常值得了解，并且它在未来可能是一个真正的爆炸。事实上，在iOS开发的世界中已经是这样了。</p>
<p>Swift于2014年6月推出，作为iOS和macOS驱动设备的原生开发语言。这是一个令人耳目一新的变化，也是一个必要的变化。当时另一种语言Objective-C是iOS开发中的主要语言。Objective-C已经非常成熟和完善，但是由于它的起源可以追溯到80年代，令人不快的语法和整体的技术限制，它肯定需要被新的东西所取代。</p>
<p>斯威夫特从第一天起就广受欢迎。它引入了现代语言结构，如泛型、可选性、类型安全或丰富枚举。它也给iOS带来了声明式编程。由于其不断的发展和“易学难精”的态度，Swift迅速成为GitHub上最快的流行语言之一，并带来了新一波iOS/macOS开发人员，他们并不热衷于学习像Objective-C这样过时的东西。</p>
<p>但这并不是故事的结尾。2015年12月，Swift面临自成立以来最重要的挑战之一。当时，苹果宣布他们正在开源Swift及其软件包管理器和一套核心库，包括一些在苹果开发领域众所周知的产品，如Foundation、Dispatch或XCTest。</p>
<p>现在，自2015年底以来，世界各地的开发者都被邀请致力于该语言的发展。不到两年前，从那时起，Swift已经取得了一些重大进展，并在如此短的时间内成为更好的语言。但同样重要的是，它不再是一种只能在苹果系列设备上运行的语言。从这一刻起，Ubuntu用户也能够享受这种全新的语言，它为许多不同的用例打开了大门，这些用例在过去并不容易注意到。<br/> <br/></p>
<p><span>故事是这样开始的……</span></p>
<p>自2015年12月开源并跨平台以来，Swift向前迈出了一大步，并在Web开发等许多不同领域找到了自己的目标。像Perfect、Kitura或Vapor这样的后端框架正获得越来越多的关注和欢迎，并因其现代和高性能的本质而备受推崇。我们还了解到，Swift可以用作机器学习的工具，在将Swift引入Android方面已经迈出了第一步，它在物联网领域也非常方便。</p>
<p>由于open Swift是开源的，Ubuntu的支持以及我们在iOS开发经验中获得的知识，我们认为不会有任何损失。我们买了一个Raspberry Pi 3，在主板上安装了Ubuntu，并深入GitHub，看看Swift ARM社区已经取得了什么成就。没有特别的期望，我们决定探索Swift在物联网领域的当前潜力，形成了一个名为嵌入式Swift的内部开放目标项目。</p>
<p>第一步是基本的一步。我们想在Raspberry Pi上安装Swift并使其可运行。你可以在GitHub上找到一些指导，但是在大多数情况下，你可以找到现成的解决方案。我的意思是，Swift需要在您的架构下编译，由于嵌入式板的处理能力有限，这需要一些时间。幸运的是，Raspberry Pi 3是这个星球上最受欢迎的主板之一，找到适合您的微处理器类型的预编译包并不困难。</p>
<p>这就是我们所做的。我们在运行Ubuntu Mate的树莓Pi 3上安装了armv7编译版的Swift。在终端中运行swift -v命令会产生一个熟悉的(至少对swift开发人员来说)输出，通知我们设备上运行的语言的当前版本。首先，我们尝试运行一个简单的“Hello World”应用程序，它很成功，因为我们设法看到了输出。之后，就到了查看Pi上Swift包的哪些部分可用的时候了。随着Swift编程语言、Swift包管理器、Foundation和Dispatch顺利运行，我们立即意识到潜力就在那里。</p>
<p><span> <br/>该造东西了！</span></p>
<p>如果你熟悉嵌入式设备的编程，你可能知道Swift不是这样做的首选语言。像JavaScript、Python甚至纯C这样的语言已经在这一领域独占鳌头，但是，嘿，这项研究的全部目的是发现是否有新成员加入这个团体的潜力。</p>
<p>在我们的第一个项目中，我们购买了一块试验板、几个led、电阻、跳线和一个DS18B20+温度传感器。有了这样的设备，很明显我们研究的第一个范围将是GPIO。</p>
<p>GPIO代表通用输入/输出。这是一种通用接口，嵌入式主板使用它来连接集成电路或外部设备。通过GPIO连接的附件没有预定义的用途，但它们完全可以由用户控制，并且可以在运行时读写。Raspberry Pi 3包含40个引脚，其中26个是GPIO引脚，其他是接地或电源引脚。这实际上为原型开发打开了一个广阔的前景。</p>
<p>为了让GPIO在Swift中运行，我们需要一个工具来与pin进行通信，Umberto Raimo的<a href="http://web.archive.org/web/20220925010926/https://github.com/uraimo/SwiftyGPIO"> SwiftyGPIO </a>是我们的首选。它提供了一个与GPIO引脚进行通信的快捷接口，为最流行的嵌入式主板提供了一些预定义的引脚布局。如果你是Raspberry Pi、BeagleBone或Banana Pi用户，你可能会发现这个库非常有用，因为它极大地简化了开发。</p>
<p>这正是我们所做的。我们建立了Swift Package Manager，将SwiftyGPIO添加到我们的项目中，并使用我们的配件构建了我们第一个由苹果现代编程语言驱动的电子电路。我们的布局非常简单，两个led(右侧和绿色)和温度传感器连接到试验板，配有两个电阻和几个跳线以保持流量正确。完成设置后，我们将试验板连接到Pi，并配置DS18B20+驱动程序，将温度信息转储到一个文本文件中。</p>
<p>之后，我们编写了一个从文件中读取温度的脚本，并根据温度打开两个led中的一个。当前温度也被打印到用户的屏幕上，既有摄氏温度也有华氏温度。这仍然是一个非常简单的电路，但是，嘿，它已经完美地工作，最终我们自己建立了一个数字温度计。这一切都发生在Swift，所以已经很令人兴奋了。但它不仅仅是可用于开发的1线协议，因为SwiftyGPIO为您提供了I2C和SPI接口或PWM信号，将您的项目带入另一个层次。考虑到这一点，并且已经看到了一些实际的例子，我们将注意力转移到了蓝牙上。<br/> <br/> <span>即将无线</span></p>
<p>还记得Core蓝牙吗？苹果公司提供给我们的甜美、平易近人的API，让他们自己的产品上的蓝牙开发变得更加容易？好吧，不要误会它在Linux上不工作，但是我们发现了一些可以被认为是一个很好的选择。Alsey Coleman Miller的蓝牙Linux只有一个目标——为Linux上的Swift提供可编程的蓝牙堆栈。</p>
<p>BluetoothLinux直接与Linux内核通信，并向开发人员公开像GATT这样的蓝牙栈的低级元素。起初听起来可能有点棘手，但是如果你已经熟悉了核心蓝牙和基于服务和特征的整个通信概念，这意味着你已经熟悉了GATT。此外，由于库中存在一些高级API，直接处理栈的低级部分并不总是必要的。</p>
<p>与Raspberry Pi 2相比，Raspberry Pi 3最大的改进之一是板载蓝牙低能耗模块。加上Swift和BluetoothLinux，这听起来像是一个完美的组合。因此，我们一如既往地使用Swift Package Manager来安装依赖项。我们的第一个测试是将Pi设置为一个信标，因为库为我们提供了一些如何做到这一点的示例。</p>
<p>实现中最重要的部分是创建一个适配器类的实例，以提供关于我们的信标的适当信息。它包括区域的唯一标识符、主要值和次要值、RSSI和测距间隔等信息。设置完成后，我们开始广播信标帧，我们的设备很快被iPhone识别出来，并准备好进行通信。总之，让我们新的Raspberry Pi-Beacon变得生动简单，就像在核心位置框架中写几行代码在苹果设备上做同样的事情一样简单。</p>
<p>但是其他蓝牙设备呢？我们已经知道它们不仅是信标，而且主要是蓝牙低能耗中心和外围设备。正如我们前面提到的，蓝牙Linux依赖于GATT协议的快速实现，包括服务和特征的实现。在库文件中有一个GATT服务器的<a href="http://web.archive.org/web/20220925010926/https://github.com/PureSwift/BluetoothLinux/" rel="noopener">示例</a>，它很好地展示了如何创建一个示例设备。API本身非常类似于核心蓝牙框架中的CBMutableService和CBMutableCharacteristic类，并提供几乎相同的功能，因此我们很容易理解如何在Linux上运行我们自己的Swift central。</p>
<p><span> <br/>那么，到目前为止我们学到了什么？</span></p>
<p>起初，我们对嵌入式Swift的可能性一无所知，但我们发现了它的潜力。苹果确实通过为基于Ubuntu的系统提供Swift二进制文件来部分支持这一想法，但让这些二进制文件在嵌入式设备上运行并提供与Swift外部附件通信的接口，纯粹是站在社区一边。</p>
<p>嵌入式Swift对我们来说是一个非常有趣的项目，让我们兴奋不已，因为它很有挑战性，在缺乏官方支持和文档的情况下，需要比平时更多的关注和研究。然而，Swift-ARM社区并没有停止支持这一想法，并将其带入新的水平，新版本的支持库比以前的版本更成熟，新的预编译Swift二进制文件提供了比过去更稳定的API。</p>
<p>公平地说，潜力已经存在，因为充满激情的社区不会停止为生活带来新的解决方案，并将Swift塑造成一种用于嵌入式设备开发的非常坚实的语言。然而，就目前而言，建议坚持使用Python或JavaScript。这些语言只是在这个领域更加成熟，并且有更大的社区，但是我们将继续关注最年轻的竞争者。</p>
<p> </p></span></div>    
</body>
</html>