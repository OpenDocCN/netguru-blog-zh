# 我们已经将 Swift 推向了嵌入式设备，以下是我们迄今为止了解到的情况

> 原文：<http://web.archive.org/web/20230307163032/https://www.netguru.com/blog/pushed-swift-into-embedded-devices>

 物联网。这三个小字的背后隐藏着成千上万的用例。在当前的科技行业中，没有多少话题像这个话题一样具有趋势性和创新性。像 Kickstarter 或 Indiegogo 这样的众筹服务也严重依赖于科技行业，如果没有物联网，就不会有这么多成功的项目。毫不奇怪，在 Netguru，我们决定更仔细地研究这个话题，并可能尝试一下未来。

## 我们将 Swift 推向了嵌入式设备……

哦，是的，我们有。但是嘿，也许你不熟悉这个话题，根本没听说过 Swift？那么，让我给你一个快速介绍这种年轻的和不断发展的编程语言，因为它非常值得了解，并且它在未来可能是一个真正的爆炸。事实上，在 iOS 开发的世界中已经是这样了。

Swift 于 2014 年 6 月推出，作为 iOS 和 macOS 驱动设备的原生开发语言。这是一个令人耳目一新的变化，也是一个必要的变化。当时另一种语言 Objective-C 是 iOS 开发中的主要语言。Objective-C 已经非常成熟和完善，但是由于它的起源可以追溯到 80 年代，令人不快的语法和整体的技术限制，它肯定需要被新的东西所取代。

斯威夫特从第一天起就广受欢迎。它引入了现代语言结构，如泛型、可选性、类型安全或丰富枚举。它也给 iOS 带来了声明式编程。由于其不断的发展和“易学难精”的态度，Swift 迅速成为 GitHub 上最快的流行语言之一，并带来了新一波 iOS/macOS 开发人员，他们并不热衷于学习像 Objective-C 这样过时的东西。

但这并不是故事的结尾。2015 年 12 月，Swift 面临自成立以来最重要的挑战之一。当时，苹果宣布他们正在开源 Swift 及其软件包管理器和一套核心库，包括一些在苹果开发领域众所周知的产品，如 Foundation、Dispatch 或 XCTest。

现在，自 2015 年底以来，世界各地的开发者都被邀请致力于该语言的发展。不到两年前，从那时起，Swift 已经取得了一些重大进展，并在如此短的时间内成为更好的语言。但同样重要的是，它不再是一种只能在苹果系列设备上运行的语言。从这一刻起，Ubuntu 用户也能够享受这种全新的语言，它为许多不同的用例打开了大门，这些用例在过去并不容易注意到。

故事是这样开始的……

自 2015 年 12 月开源并跨平台以来，Swift 向前迈出了一大步，并在 Web 开发等许多不同领域找到了自己的目标。像 Perfect、Kitura 或 Vapor 这样的后端框架正获得越来越多的关注和欢迎，并因其现代和高性能的本质而备受推崇。我们还了解到，Swift 可以用作机器学习的工具，在将 Swift 引入 Android 方面已经迈出了第一步，它在物联网领域也非常方便。

由于 open Swift 是开源的，Ubuntu 的支持以及我们在 iOS 开发经验中获得的知识，我们认为不会有任何损失。我们买了一个 Raspberry Pi 3，在主板上安装了 Ubuntu，并深入 GitHub，看看 Swift ARM 社区已经取得了什么成就。没有特别的期望，我们决定探索 Swift 在物联网领域的当前潜力，形成了一个名为嵌入式 Swift 的内部开放目标项目。

第一步是基本的一步。我们想在 Raspberry Pi 上安装 Swift 并使其可运行。你可以在 GitHub 上找到一些指导，但是在大多数情况下，你可以找到现成的解决方案。我的意思是，Swift 需要在您的架构下编译，由于嵌入式板的处理能力有限，这需要一些时间。幸运的是，Raspberry Pi 3 是这个星球上最受欢迎的主板之一，找到适合您的微处理器类型的预编译包并不困难。

这就是我们所做的。我们在运行 Ubuntu Mate 的树莓 Pi 3 上安装了 armv7 编译版的 Swift。在终端中运行 swift -v 命令会产生一个熟悉的(至少对 swift 开发人员来说)输出，通知我们设备上运行的语言的当前版本。首先，我们尝试运行一个简单的“Hello World”应用程序，它很成功，因为我们设法看到了输出。之后，就到了查看 Pi 上 Swift 包的哪些部分可用的时候了。随着 Swift 编程语言、Swift 包管理器、Foundation 和 Dispatch 顺利运行，我们立即意识到潜力就在那里。

 该造东西了！

如果你熟悉嵌入式设备的编程，你可能知道 Swift 不是这样做的首选语言。像 JavaScript、Python 甚至纯 C 这样的语言已经在这一领域独占鳌头，但是，嘿，这项研究的全部目的是发现是否有新成员加入这个团体的潜力。

在我们的第一个项目中，我们购买了一块试验板、几个 led、电阻、跳线和一个 DS18B20+温度传感器。有了这样的设备，很明显我们研究的第一个范围将是 GPIO。

GPIO 代表通用输入/输出。这是一种通用接口，嵌入式主板使用它来连接集成电路或外部设备。通过 GPIO 连接的附件没有预定义的用途，但它们完全可以由用户控制，并且可以在运行时读写。Raspberry Pi 3 包含 40 个引脚，其中 26 个是 GPIO 引脚，其他是接地或电源引脚。这实际上为原型开发打开了一个广阔的前景。

为了让 GPIO 在 Swift 中运行，我们需要一个工具来与 pin 进行通信，Umberto Raimo 的 [SwiftyGPIO](http://web.archive.org/web/20220925010926/https://github.com/uraimo/SwiftyGPIO) 是我们的首选。它提供了一个与 GPIO 引脚进行通信的快捷接口，为最流行的嵌入式主板提供了一些预定义的引脚布局。如果你是 Raspberry Pi、BeagleBone 或 Banana Pi 用户，你可能会发现这个库非常有用，因为它极大地简化了开发。

这正是我们所做的。我们建立了 Swift Package Manager，将 SwiftyGPIO 添加到我们的项目中，并使用我们的配件构建了我们第一个由苹果现代编程语言驱动的电子电路。我们的布局非常简单，两个 led(右侧和绿色)和温度传感器连接到试验板，配有两个电阻和几个跳线以保持流量正确。完成设置后，我们将试验板连接到 Pi，并配置 DS18B20+驱动程序，将温度信息转储到一个文本文件中。

之后，我们编写了一个从文件中读取温度的脚本，并根据温度打开两个 led 中的一个。当前温度也被打印到用户的屏幕上，既有摄氏温度也有华氏温度。这仍然是一个非常简单的电路，但是，嘿，它已经完美地工作，最终我们自己建立了一个数字温度计。这一切都发生在 Swift，所以已经很令人兴奋了。但它不仅仅是可用于开发的 1 线协议，因为 SwiftyGPIO 为您提供了 I2C 和 SPI 接口或 PWM 信号，将您的项目带入另一个层次。考虑到这一点，并且已经看到了一些实际的例子，我们将注意力转移到了蓝牙上。

即将无线

还记得 Core 蓝牙吗？苹果公司提供给我们的甜美、平易近人的 API，让他们自己的产品上的蓝牙开发变得更加容易？好吧，不要误会它在 Linux 上不工作，但是我们发现了一些可以被认为是一个很好的选择。Alsey Coleman Miller 的蓝牙 Linux 只有一个目标——为 Linux 上的 Swift 提供可编程的蓝牙堆栈。

BluetoothLinux 直接与 Linux 内核通信，并向开发人员公开像 GATT 这样的蓝牙栈的低级元素。起初听起来可能有点棘手，但是如果你已经熟悉了核心蓝牙和基于服务和特征的整个通信概念，这意味着你已经熟悉了 GATT。此外，由于库中存在一些高级 API，直接处理栈的低级部分并不总是必要的。

与 Raspberry Pi 2 相比，Raspberry Pi 3 最大的改进之一是板载蓝牙低能耗模块。加上 Swift 和 BluetoothLinux，这听起来像是一个完美的组合。因此，我们一如既往地使用 Swift Package Manager 来安装依赖项。我们的第一个测试是将 Pi 设置为一个信标，因为库为我们提供了一些如何做到这一点的示例。

实现中最重要的部分是创建一个适配器类的实例，以提供关于我们的信标的适当信息。它包括区域的唯一标识符、主要值和次要值、RSSI 和测距间隔等信息。设置完成后，我们开始广播信标帧，我们的设备很快被 iPhone 识别出来，并准备好进行通信。总之，让我们新的 Raspberry Pi-Beacon 变得生动简单，就像在核心位置框架中写几行代码在苹果设备上做同样的事情一样简单。

但是其他蓝牙设备呢？我们已经知道它们不仅是信标，而且主要是蓝牙低能耗中心和外围设备。正如我们前面提到的，蓝牙 Linux 依赖于 GATT 协议的快速实现，包括服务和特征的实现。在库文件中有一个 GATT 服务器的[示例](http://web.archive.org/web/20220925010926/https://github.com/PureSwift/BluetoothLinux/)，它很好地展示了如何创建一个示例设备。API 本身非常类似于核心蓝牙框架中的 CBMutableService 和 CBMutableCharacteristic 类，并提供几乎相同的功能，因此我们很容易理解如何在 Linux 上运行我们自己的 Swift central。

 那么，到目前为止我们学到了什么？

起初，我们对嵌入式 Swift 的可能性一无所知，但我们发现了它的潜力。苹果确实通过为基于 Ubuntu 的系统提供 Swift 二进制文件来部分支持这一想法，但让这些二进制文件在嵌入式设备上运行并提供与 Swift 外部附件通信的接口，纯粹是站在社区一边。

嵌入式 Swift 对我们来说是一个非常有趣的项目，让我们兴奋不已，因为它很有挑战性，在缺乏官方支持和文档的情况下，需要比平时更多的关注和研究。然而，Swift-ARM 社区并没有停止支持这一想法，并将其带入新的水平，新版本的支持库比以前的版本更成熟，新的预编译 Swift 二进制文件提供了比过去更稳定的 API。

公平地说，潜力已经存在，因为充满激情的社区不会停止为生活带来新的解决方案，并将 Swift 塑造成一种用于嵌入式设备开发的非常坚实的语言。然而，就目前而言，建议坚持使用 Python 或 JavaScript。这些语言只是在这个领域更加成熟，并且有更大的社区，但是我们将继续关注最年轻的竞争者。