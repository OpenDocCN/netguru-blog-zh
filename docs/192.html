<html>
<head>
<title>How to Speed Up Assets Precompilation Time in Ruby on Rails</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>如何在Ruby on Rails中加快资产预编译时间</h1>
<blockquote>原文：<a href="http://web.archive.org/web/20230307163032/https://www.netguru.com/blog/speed-up-assets-precompilation-time-in-a-rails-app#0001-01-01">http://web.archive.org/web/20230307163032/https://www.netguru.com/blog/speed-up-assets-precompilation-time-in-a-rails-app#0001-01-01</a></blockquote><div><div id="hs_cos_wrapper_post_body"><span><div class="blog-post__lead h2"><p>每个Rails开发人员都知道加载资产非常耗时。这里有一些关于如何加快速度的有用提示。</p></div><h2>技巧</h2>
<ul>
<li>不要将所有内容打包成一个大文件。将CDN用于CKeditor等工具，并且只在需要它的页面上需要它。</li>
<li>将翻译保存在单独的文件中。仅配置所需的语言。O <g class="gr_ gr_39 gr-alert gr_gramm gr_inline_cards gr_run_anim Punctuation only-ins replaceWithoutSep" id="39" data-gr-id="39">否则，</g>翻译文件可能会随着每个新的库一起膨胀得非常快。如果您只配置所需的语言，您将避免大的编译文件，这意味着更快的编译和页面加载。<pre>config.i18n.available_locales = %i(en)</pre></li>
<li><span> <g class="gr_ gr_47 gr-alert gr_gramm gr_inline_cards gr_run_anim Style multiReplace" id="47" data-gr-id="47">去掉</g><span><g class="gr_ gr_47 gr-alert gr_gramm gr_inline_cards gr_disable_anim_appear Style multiReplace" id="47" data-gr-id="47"/></span></span><code>gem 'therubyracer'</code><span><span><g class="gr_ gr_47 gr-alert gr_gramm gr_inline_cards gr_disable_anim_appear Style multiReplace" id="47" data-gr-id="47"/></span><g class="gr_ gr_48 gr-alert gr_gramm gr_inline_cards gr_run_anim Style multiReplace" id="48" data-gr-id="48"><g class="gr_ gr_47 gr-alert gr_gramm gr_inline_cards gr_disable_anim_appear Style multiReplace" id="47" data-gr-id="47">从</g></g><span><g class="gr_ gr_48 gr-alert gr_gramm gr_inline_cards gr_disable_anim_appear Style multiReplace" id="48" data-gr-id="48"/></span></span><code>Gemfile</code><span><span><g class="gr_ gr_48 gr-alert gr_gramm gr_inline_cards gr_disable_anim_appear Style multiReplace" id="48" data-gr-id="48"/></span><g class="gr_ gr_48 gr-alert gr_gramm gr_inline_cards gr_disable_anim_appear Style multiReplace" id="48" data-gr-id="48">因为</g>这个宝石使用了大量的内存。请确保安装了最新版本的节点。<span><br/></span></span><a href="http://web.archive.org/web/20220929114734/https://devcenter.heroku.com/articles/rails-asset-pipeline#therubyracer" rel="nofollow">https://dev center . heroku . com/articles/rails-asset-pipeline # therubyracer</a></li>
<li><span>请勿使用<span/></span><code>require</code><span><span/></span><code>require_tree</code><span><span/><g class="gr_ gr_51 gr-alert gr_gramm gr_inline_cards gr_run_anim Style multiReplace" id="51" data-gr-id="51"><g class="gr_ gr_50 gr-alert gr_gramm gr_inline_cards gr_run_anim Style multiReplace" id="50" data-gr-id="50">和</g></g><span><g class="gr_ gr_51 gr-alert gr_gramm gr_inline_cards gr_disable_anim_appear Style multiReplace" id="51" data-gr-id="51"/></span></span><code>require_self</code><span><span><g class="gr_ gr_51 gr-alert gr_gramm gr_inline_cards gr_disable_anim_appear Style multiReplace" id="51" data-gr-id="51"/></span><g class="gr_ gr_51 gr-alert gr_gramm gr_inline_cards gr_disable_anim_appear Style multiReplace" id="51" data-gr-id="51">在</g> your SASS/SCSS文件中。它们非常原始，不能很好地处理Sass文件。相反，使用Sass的<g class="gr_ gr_52 gr-alert gr_gramm gr_inline_cards gr_run_anim Style multiReplace" id="52" data-gr-id="52">原生</g><span><g class="gr_ gr_52 gr-alert gr_gramm gr_inline_cards gr_disable_anim_appear Style multiReplace" id="52" data-gr-id="52"/></span></span><code>@import</code><span><span><g class="gr_ gr_52 gr-alert gr_gramm gr_inline_cards gr_disable_anim_appear Style multiReplace" id="52" data-gr-id="52"/></span><g class="gr_ gr_52 gr-alert gr_gramm gr_inline_cards gr_disable_anim_appear Style multiReplace" id="52" data-gr-id="52">指令，</g>Sass-rails已经定制了这些指令来与您的Rails项目的约定相集成。<span><br/></span></span><a href="http://web.archive.org/web/20220929114734/https://github.com/rails/sass-rails#important-note">https://github.com/rails/sass-rails#important-note<br/></a></li>
<li><span>在你的SASS/SCSS文件<g class="gr_ gr_45 gr-alert gr_gramm gr_inline_cards gr_run_anim Style multiReplace" id="45" data-gr-id="45">中小心使用</g><span><g class="gr_ gr_45 gr-alert gr_gramm gr_inline_cards gr_disable_anim_appear Style multiReplace" id="45" data-gr-id="45"/></span></span><code>@import</code><span><span><g class="gr_ gr_45 gr-alert gr_gramm gr_inline_cards gr_disable_anim_appear Style multiReplace" id="45" data-gr-id="45"/></span><g class="gr_ gr_45 gr-alert gr_gramm gr_inline_cards gr_disable_anim_appear Style multiReplace" id="45" data-gr-id="45">指令</g>。避免将所有的包资产<g class="gr_ gr_53 gr-alert gr_gramm gr_inline_cards gr_run_anim Style multiReplace" id="53" data-gr-id="53">导入为</g><span><g class="gr_ gr_53 gr-alert gr_gramm gr_inline_cards gr_disable_anim_appear Style multiReplace" id="53" data-gr-id="53"/></span></span><code>@import 'compass';</code><span><span><g class="gr_ gr_53 gr-alert gr_gramm gr_inline_cards gr_disable_anim_appear Style multiReplace" id="53" data-gr-id="53"/></span><g class="gr_ gr_53 gr-alert gr_gramm gr_inline_cards gr_disable_anim_appear Style multiReplace" id="53" data-gr-id="53"/>时只能<g class="gr_ gr_54 gr-alert gr_gramm gr_inline_cards gr_run_anim Style multiReplace" id="54" data-gr-id="54">做</g><span><g class="gr_ gr_54 gr-alert gr_gramm gr_inline_cards gr_disable_anim_appear Style multiReplace" id="54" data-gr-id="54"/></span></span><code>@import 'compass/css3/flexbox'</code><span><g class="gr_ gr_54 gr-alert gr_gramm gr_inline_cards gr_disable_anim_appear Style multiReplace" id="54" data-gr-id="54">。</g> </span></li>
<li><span> <span> <span>避免<g class="gr_ gr_35 gr-alert gr_gramm gr_inline_cards gr_run_anim Style multiReplace" id="35" data-gr-id="35">使用</g><span><g class="gr_ gr_35 gr-alert gr_gramm gr_inline_cards gr_disable_anim_appear Style multiReplace" id="35" data-gr-id="35"/></span></span><code>require_tree .</code><span><span><g class="gr_ gr_35 gr-alert gr_gramm gr_inline_cards gr_disable_anim_appear Style multiReplace" id="35" data-gr-id="35"/></span><g class="gr_ gr_35 gr-alert gr_gramm gr_inline_cards gr_disable_anim_appear Style multiReplace" id="35" data-gr-id="35"><g class="gr_ gr_34 gr-alert gr_gramm gr_inline_cards gr_run_anim Grammar only-ins doubleReplace replaceWithoutSep" id="34" data-gr-id="34">指令</g> </g>在你的JS/COFFEE中体现。让我们想象一个<g class="gr_ gr_36 gr-alert gr_gramm gr_inline_cards gr_run_anim Grammar only-ins doubleReplace replaceWithoutSep" id="36" data-gr-id="36">场景</g>，其中你的应用有一个管理面板，有单独的资产:<br/> </span> </span> </span> <pre><span class="pl-c"><span class="pl-c">//</span>** assets/javascripts/admin/admin.js</span>  <span class="pl-c"><span class="pl-c">//</span>= require admin/tab.js</span> <span class="pl-c"><span class="pl-c">//</span>= ...</span></pre> <pre><span class="pl-c"><span class="pl-c">//</span>** assets/javascripts/application.js</span>  <span class="pl-c"><span class="pl-c">//</span>= require 'something'</span> <span class="pl-c"><span class="pl-c">//</span>= require_tree . // BAD! it requires admin assets as well</span></pre></li>
<li>编译资产时检查日志。通过访问调试模式，可以很容易地覆盖默认的日志记录器，并查看幕后发生了什么。<br/> <pre><span class="pl-c"><span class="pl-c">#</span> /lib/tasks/assets.rake</span>  <span class="pl-k">require</span> <span class="pl-s"><span class="pl-pds">'</span>sprockets/rails/task<span class="pl-pds">'</span></span>  <span class="pl-c1">Sprockets</span>::<span class="pl-c1">Rails</span>::<span class="pl-c1">Task</span>.<span class="pl-k">new</span>(<span class="pl-c1">Rails</span>.application) <span class="pl-k">do</span> |<span class="pl-smi">t</span>|   t.logger <span class="pl-k">=</span> <span class="pl-c1">Logger</span>.<span class="pl-k">new</span>(<span class="pl-c1">STDOUT</span>) <span class="pl-k">end</span></pre></li>
</ul>
<h2><span class="pl-k"> <span>汇总</span> </span></h2>
<p>以上提示可以帮助你更快的检索到你编译好的资产！作为概念的证明，请查看一下<a href="http://web.archive.org/web/20220929114734/https://github.com/cintrzyk/sprockets-tips"><g class="gr_ gr_32 gr-alert gr_spell gr_inline_cards gr_run_anim ContextualSpelling" id="32" data-gr-id="32">cintrzyk</g>/链轮-提示</a>，在这里你可以<a href="/web/20220929114734/https://www.netguru.com/services/ruby-on-rails-development" rel="noopener">找到一个带有更多细节的示例Rails应用</a>。Rails 5.1引入了其他一些管理资产的方式。我强烈推荐你<g class="gr_ gr_204 gr-alert gr_gramm gr_inline_cards gr_run_anim Grammar multiReplace" id="204" data-gr-id="204">用</g>纱搭配Webpack，<g class="gr_ gr_205 gr-alert gr_spell gr_inline_cards gr_run_anim ContextualSpelling multiReplace" id="205" data-gr-id="205">值得</g>相信我！您所能获得的是资产依赖的管理、更高效的编译过程、无需页面刷新的代码热重装、ES6支持、PostCSS等等！</p></span></div></div>    
</body>
</html>