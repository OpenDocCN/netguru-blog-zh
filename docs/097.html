<html>
<head>
<title>Creating Images in Go</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>在Go中创建图像</h1>
<blockquote>原文：<a href="http://web.archive.org/web/20230307163032/https://www.netguru.com/blog/creating-images-in-go#0001-01-01">http://web.archive.org/web/20230307163032/https://www.netguru.com/blog/creating-images-in-go#0001-01-01</a></blockquote><div><span><div class="blog-post__lead h2"><p>本帖是最初出现在<a href="http://web.archive.org/web/20221202083142/https://szeliga.github.io/2016/09/02/creating-images/" target="_blank">上的围棋</a>中的<a href="http://web.archive.org/web/20221202083142/https://www.netguru.com/blog/vector-operations-in-go">向量运算经过八次编码后的延续。</a></p></div><h2>序</h2>
<p>在实现相机模型之前，最好有一些调试工具。当编写光线跟踪器时，该工具是一个渲染图像。</p>
<p>Go有一个内置的<a href="http://web.archive.org/web/20221202083142/https://golang.org/pkg/image/">图像</a>包，允许轻松创建图像并将其保存为磁盘上的文件。</p>
<p>这篇文章的代码可以在这里查看<a href="http://web.archive.org/web/20221202083142/https://github.com/Szeliga/goray/tree/03-creating-images">。</a></p>
<h2 id="design">设计</h2>
<p>该场景将由一个结构来表示。在内部，它将存储所需图像的宽度和高度，以及一个指向<span>图像实例的指针。RGBA </span>。</p>
<p data-gist-id="c8eccf0805178de59f514e9034c894da">[代码]</p>
<h3 id="initialization">初始化中</h3>
<p>为了初始化场景，我们需要初始化<span>图像。给定尺寸的RGBA </span>。在Go中，这是通过创建一个<span>图像来实现的。Rect </span> struct并将其传递给<span>映像。NewRGBA </span>功能。</p>
<p>初始化场景所需的全部代码将在<span> NewScene </span>函数中完成。该函数应该接受两个整数作为参数，表示图像的宽度和高度:</p>
<p data-gist-id="39b5aa477255da7fb971410d87033eda">[代码]</p>
<p>assert库公开了一些漂亮的帮助函数，如<span><a href="http://web.archive.org/web/20221202083142/https://godoc.org/github.com/stretchr/testify/assert#ObjectsAreEqualValues">objects areequalvalues</a>，</span>对对象的值进行深度相等检查。</p>
<h3 id="test-helpers">测试助手</h3>
<p>为了测试下面的函数，我需要编写两个助手函数来生成一个新的<span>图像。RGBA </span>并用随机颜色填充图像:</p>
<p data-gist-id="55b90a1976f05aff210eb57d79e48bf3">[代码]</p>
<p>我使用这些助手来生成预期的<span>图像。RGBA </span>的对象为<span>的对象为</span>的对象。</p>
<h3 id="traversing-the-image">遍历图像</h3>
<p>对于图像的每个像素，我想设置一个特定的颜色。这可以通过一个双for循环简单地完成，但是我们可以在<span>场景</span>上公开一个方便的函数，叫做<span>每个像素</span>。Go允许我们将函数指定为其他函数的参数。我们将利用这一事实，在<span>每个像素</span>中需要一个参数——一个具有以下签名的函数<span> func(int，int) color。RGBA </span>。两个<span> int </span>值是图像的<span> x </span>和<span> y </span>坐标(稍后将用于计算图像平面中的像素)。<span> EachPixel </span>函数的完整实现如下:</p>
<p data-gist-id="e6530f0dccbee5690b03aba8e7f20213">[代码]</p>
<p><span> setPixel </span>函数只是Go内置<span>图像的一个适配器。RGBA .设定</span>。</p>
<h3 id="saving-the-image">保存图像</h3>
<p>最后，我想将图像保存到一个PNG文件中。正如人们可能怀疑的那样，Go在<span> image/png </span>包中提供了这样一个函数，叫做<span> png。编码</span>。同样，我为这个函数构建了一个适配器，它接受一个文件名，在这个文件名下保存图像。</p>
<p data-gist-id="5f51996bb2690bff1f10910e17b54d19">[代码]</p>
<p>这段代码中发生了几件有趣的事情:</p>
<ul>
<li><span> os。Create(filename) </span> —函数有多次返回；这是Go 中<a href="http://web.archive.org/web/20221202083142/https://blog.golang.org/error-handling-and-go">错误处理的常见模式:</a><ul>
<li><span> f </span> —文件描述符，</li>
<li><span> err </span> —文件创建过程中可能发生的任何错误，例如权限不足；</li>
</ul>
</li>
<li><span>defer f . Close()</span>—<a href="http://web.archive.org/web/20221202083142/https://tour.golang.org/flowcontrol/12">defer关键字</a>延迟执行传递的代码，直到周围的函数返回；在这种情况下，文件不会关闭，直到Save函数执行完它的命令；</li>
<li><span>断言。panics</span>—assert库的另一个很好的特性，不是获取断言的预期/实际值，而是获取一个应该会死机(引发异常)的函数，如果这个函数确实死机了，它就通过了测试；这类似于RSpec的<span> expect { subject }。提高_error标准错误；</span></li>
</ul>
<h3 id="putting-it-all-together">把所有的放在一起</h3>
<p>下面是一个简单的main函数，它使用基于当前像素的值填充图像:</p>
<p data-gist-id="89af091b816b985dcb27aa6bbecb6328">[代码]</p>
<p>这段代码生成了以下图像:</p>
<figure><figure class="image&#10;    &#10;    image--framed&#10;    " data-image="" data-component="image">
    <img class="image__content" srcset="http://web.archive.org/web/20221202083142im_/https://www.netguru.com/hs-fs/hubfs/Blog_posts_-_images/image.png?width=200&amp;name=image.png 200w, http://web.archive.org/web/20221202083142im_/https://www.netguru.com/hs-fs/hubfs/Blog_posts_-_images/image.png?width=400&amp;name=image.png 400w" src="../Images/8eba4ebf2f185c54bbbc31cd4e8772d6.png" alt="image.png" loading="lazy" data-image-content="" data-original-src="http://web.archive.org/web/20221202083142im_/https://www.netguru.com/hs-fs/hubfs/Blog_posts_-_images/image.png?width=200&amp;name=image.png"/>
  </figure></figure>
<p> </p>
<p>以上是关于在Go中创建和保存图像的全部内容。接下来，一个基本的相机模型，敬请关注。</p></span></div>    
</body>
</html>