# 如何设置自动 Docker 暂存-迷你指南

> 原文：<http://web.archive.org/web/20230307163032/https://www.netguru.com/blog/automatic-docker-staging>

 动态分段或集成使用 Docker 和 Docker Compose 的组合功能，Docker Compose 是一个工具，它让您可以轻松地配置和链接具有单个 YAML 文件的容器，以及构建具有链接服务(如数据库、redis 等)的容器。看看如何设置自动 Docker staging，以及我们在 Netguru 上是如何做的。

## Netguru 是怎么运作的？

每次创建拉请求时，GitHub 都会向我们专门创建的应用程序 Heaven 发送一个 webhook，该应用程序会获取特定分支的最新 Git 版本以及拉请求编号，并使用所述 Docker Compose 配置“构建”应用程序，该配置稍后可由在 docker-compose.yml. 中指定的主机访问

Docker 编写器配置示例可能如下所示:

[代码]

我们在第 2 行定义了应该构建什么，并在第 3 行提供了 Dockerfile。

我们有一个链接部分，它链接了第 12 行和第 14 行的容器，这些容器构建在给定的图像上，以后可以从我们的“主”应用程序容器中访问。我们可以很容易地为我们的容器和其他选项设置环境变量，例如 cpu_quota 或主机名。

只要我们的 pull 请求被打开，每个对 PR 的新提交都会用新代码重新构建容器，所以当我们访问我们在配置文件的第 8 行提供的主机时，我们应该看到我们的“动态”设置应用程序。

当使用拉请求开发应用程序时，每个票据都有自己的分支，这意味着每个票据都有自己的拉请求。这使我们能够测试仅在我们的票证范围内的更改，并且我们不必担心其他人的更改可能会破坏应用程序。它也有一个缺点——一方面，每个动态 staging 都有自己的数据库容器，我们可以破坏它，但是——另一方面，正常和动态 staging 之间的数据没有链接，这意味着我们必须为我们需要的初始数据库状态指定种子。

你认为这个解决方案怎么样？请在下面的评论中告诉我！