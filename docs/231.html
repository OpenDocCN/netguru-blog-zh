<html>
<head>
<title>Flawless React/Redux Testing with the Jest Framework - Part 1</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>用Jest框架进行完美的React/Redux测试——第1部分</h1>
<blockquote>原文：<a href="http://web.archive.org/web/20230307163032/https://www.netguru.com/blog/flawless-react/redux-testing-with-the-jest-framework-part-1#0001-01-01">http://web.archive.org/web/20230307163032/https://www.netguru.com/blog/flawless-react/redux-testing-with-the-jest-framework-part-1#0001-01-01</a></blockquote><div><span><div class="blog-post__lead h3"><p>测试React/Redux应用程序可能是一个问题。最近，随着每天都有新的工具被创造出来，选择合适的工具变得比以往更加困难。在本文中，我将向您展示如何使用Jest来完成您的测试。</p></div><p>先简单介绍一下什么是<span> Jest </span>吧。Jest是由脸书开发的Javascript测试框架。它是在Jasmine的基础上做了一些很大的改进。一些花哨的<span>笑话</span>功能有:</p>
<ul>
<li>内置支持里面有<span> jsdom </span>的DOM，</li>
<li>集成的人工模拟库，</li>
<li>支持测试异步代码，</li>
<li>观看模式！–仅对发生更改的文件运行测试，</li>
<li>自动覆盖报告的创建，</li>
<li>快照测试–创建生成内容的快照并进行比较，以简化UI测试。</li>
</ul>
<br/>
<p>要开始使用<span> Jest </span>，你可以下载<span> create-react-app </span>包，这是一种引导新的个人项目的便捷方式。</p>
<p data-gist-id="51cc78755a726040c93e5d89b21cb025"><span>$ NPM install-g create react-app</span><br/><span>$ create-react-app net guru-react-redux-1</span><br/><span>$ CD net guru-react-redux-1&amp;&amp;NPM start</span></p>
<p>现在，您可以使用以下命令在观察模式下启动您的测试:</p>
<span>$ npm test</span><br/>
<p>在引擎盖下运行:</p>
<span>$ jest --watch</span><br/><br/>
<p>在每个React/Redux项目中，你至少需要创建和测试四样东西:reducer、actions、component、container。在本教程中，我们将看看前两个。</p>
<p>假设我们有一个从远程服务器加载报价的应用程序。我们的减速器看起来如下:</p>
<p data-gist-id="38093719f6b8a1fe0403f3779b094589">[代码]</p>
<p>测试减速器非常简单。这里没有魔法。</p>
<p data-gist-id="c0338cfca9ec52d36b81ffd8a2561aa5">[代码]</p>
<p><strong>提示:</strong>我们使用<span>等同于</span>而不是<span>等同于</span>，因为我们需要通过值来比较对象。<span> toEqual </span>执行深度相等，因此它对于对象或数组是必需的。</p>
<p> </p>
<p>检查reducer是否输出了期望的初始状态，并检查一旦分派了未知动作，它是否返回了当前状态，这是一个很好的实践。换句话说，当我们在状态树的其他部分执行一个动作时，你更希望检查它没有丢失状态。相信我，这个简单的检查有时可以节省几个小时的调试时间。</p>
<br/>
<p>我们的动作也很基础。我们一执行它，它就调度<span> FETCH_QUOTES_REQUEST，</span>，这样我们就可以用它来显示，比如一个装载指示器。</p>
<p>接下来，它调用API，并根据响应，调度带有数据的<span> FETCH_QUOTES_SUCCESS </span>或<span> FETCH_QUOTES_FAILURE </span>。</p>
<br/>
<p>为了异步调度redux动作，除了使用<span> redux </span>，我们还需要使用<span> redux-thunk </span>。这里有一件重要的事情:我们需要从我们的行动中返回<span>承诺</span>，以便<span> Jest </span>知道如何处理它并等待它解决。</p>
<p data-gist-id="2ca5ab65a6e31aca7e7f5ea7ef4162e4">[代码]</p>
<p>这里的事情越来越有趣了。我们需要测试两个场景:(1)服务器用一个有效的响应进行响应，以及(2)服务器用一个错误进行响应。我们使用<span/><span>fetch-mock</span><span><span/>包</span>来模拟服务器响应，它有一个非常简单的API。我们还需要<span> redux-mock-store </span>，它提供了一个有用的方法来检查分派的动作。类似于我们在动作中所做的，我们也需要在这里返回<span>承诺</span>来让<span> Jest </span>知道它应该如何处理它。</p>
<p data-gist-id="6482638c061b0b8ff4c91acfc0dfab9d">[代码]</p>
<p>请记住，我们需要调用<span>fetch mock . restore()；方法来重置fetch mock，并在下一个测试用例中为我们的请求使用不同的响应。最好在每个测试用例之后运行的</span>函数之后的<span>中进行这种重置——这样，我们的测试将保持整洁。</span></p>
<br/>
<p>敬请关注我们未来的帖子！我们将测试应用程序的React部分，并使用更多Jest的功能来创建一个完整的测试套件。</p></span></div>    
</body>
</html>